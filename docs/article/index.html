<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="./lib/highlight.github.min.css" />
        <script src="./lib/marked.min.js"></script>
        <script src="./lib/pangu.min.js"></script>
        <script src="./lib/jquery-3.3.1.min.js"></script>
        <script src="./lib/highlight.min.js"></script>
        <title>Article</title>
        <style>
            i {
                -moz-user-select: none;
                -webkit-user-select: none;
                -ms-user-select: none;
                user-select: none;
            }

            *::-webkit-scrollbar {
                width: 6px;
                height: 6px;
                background-color: rgba(214, 214, 214, 0.2);
            }

            *::-webkit-scrollbar-thumb {
                background-color: rgba(59, 178, 237, 0.22);
                border-radius: 6px;
                transition: background-color 0.3s;
            }

            *::-webkit-scrollbar-thumb:hover {
                background-color: rgba(75, 175, 225, 1);
            }

            *::-webkit-scrollbar-thumb:active {
                background-color: rgba(100, 200, 250, 1);
            }

            *::-webkit-scrollbar-cornor {
                background-color: rgba(100, 200, 250, 1);
                border-radius: 2px;
                transition: background-color 0.3s;
            }

            *::-webkit-scrollbar-cornor:hover {
                background-color: rgba(100, 200, 250, 0.5);
            }

            * {
                font-family: 'MPlus', '等距更纱黑体 SC', 'mononoki regular', 'Consolas', monospace;
            }

            :root {
                --prime-color: #fff7f1;
                --prime-color-darker: #fce0cb;
                --backgroud-color: #f4f7f9;
                --backgroud-color-darker: #e3e9ee;
            }

            html,
            body {
                margin: 0;
                height: 100%;
                overflow-y: hidden;
            }

            body {
                display: flex;
                flex-direction: column;
                justify-content: space-between;
            }

            header {
                border-bottom: 1px #acacac solid;
                box-shadow: 0 0 5px 3px #dddddd;
                height: 4vh;
                line-height: 4vh;
                padding-left: 30px;
                font-weight: bold;
                z-index: 2; /* 防止阴影被覆盖 */
            }

            #main {
                display: flex;
                flex-direction: row;
                height: 96vh;
            }

            #list {
                width: 300px;
                border-right: 1px #acacac solid;
                overflow-x: hidden;
                overflow-y: auto;
                padding-bottom: 10px;
            }

            #list .menu {
                padding: 0;
                margin: 0;
                cursor: default;
            }

            #list .menu .item {
                padding: 10px 30px;
                overflow: hidden;
                width: 240px;
            }

            #list .menu .item > p {
                margin: 0;
                word-break: keep-all;
                width: fit-content;
                white-space: nowrap;
                min-width: 100%;
            }

            #list .menu .item > p:hover {
                animation: 5s wordsLoop linear infinite normal;
            }

            #list .menu .item.active {
                background-color: var(--prime-color);
            }

            #marked-wrapper {
                overflow-y: auto;
                flex: 1;
            }

            #marked {
                width: 800px;
                margin: 30px auto;
            }

            #marked a {
                color: black;
                text-decoration: underline dotted 0.1rem grey;
                text-underline-offset: 0.3rem;
            }

            #marked blockquote {
                box-sizing: border-box;
                background-color: var(--backgroud-color);
                mix-blend-mode: multiply;
                margin-right: 0;
                border-left: var(--backgroud-color-darker) solid 0.3rem;
                padding-left: 0.5rem;
                margin-inline-start: 2rem;
            }

            #marked h1 {
                font-size: 1.7rem;
                margin-block-start: 0.67rem;
                margin-block-end: 0.67rem;
            }

            #marked h2 {
                font-size: 1.6rem;
                margin-block-start: 0.77rem;
                margin-block-end: 0.67rem;
            }

            #marked h3 {
                font-size: 1.5rem;
                margin-block-start: 0.87rem;
                margin-block-end: 0.67rem;
            }

            #marked h4 {
                font-size: 1.4rem;
                margin-block-start: 0.97rem;
                margin-block-end: 0.67rem;
            }

            #marked h5 {
                font-size: 1.3rem;
                margin-block-start: 0.97rem;
                margin-block-end: 0.67rem;
            }

            #marked h6 {
                font-size: 1.2rem;
                margin-block-start: 0.97rem;
                margin-block-end: 0.67rem;
            }

            #marked img {
                max-width: 600px;
                display: block;
                margin-left: 2rem;
            }

            #marked p {
                margin-block-start: 0.7em;
                margin-block-end: 0.7em;
            }

            #marked pre .hljs {
                background-color: var(--backgroud-color);
                overflow-x: auto;
            }

            #marked table {
                border-collapse: collapse;
            }

            #marked table th {
                background-color: var(--prime-color);
            }

            #marked table th,
            #marked table td {
                border-collapse: collapse;
                border: black solid 0.01rem;
                padding: 0 0.5rem 0;
            }

            #loading {
                width: 20px;
                height: 20px;
                position: fixed;
                user-select: none;
                z-index: 10;
                top: 50%;
                left: 50%;
                border-top: #ff6d00 solid 0.01rem;
                border-left: white solid 0.01rem;
                border-bottom: #ff6d00 solid 0.01rem;
                border-right: white solid 0.01rem;
                border-radius: 100%;
                animation: 0.8s loading linear infinite normal;
            }

            @-webkit-keyframes loading {
                0% {
                    transform: translate(calc(-50% + 150px), -50%) rotate(0);
                }
                100% {
                    transform: translate(calc(-50% + 150px), -50%) rotate(360deg);
                }
            }

            @-webkit-keyframes wordsLoop {
                0%,
                20% {
                    transform: translateX(0px);
                }
                45%,
                55% {
                    transform: translateX(calc(-100% + 240px));
                }
                80%,
                100% {
                    transform: translateX(0px);
                }
            }
        </style>
    </head>
    <body>
        <header>articles</header>
        <div id="main">
            <div id="list"></div>
            <div id="marked-wrapper">
                <div id="marked"></div>
            </div>
        </div>
        <div id="loading"></div>
    </body>
    <script>
        loading(true);

        marked.setOptions({
            baseUrl: '/pages/docs/article/md/'
        });

        let param = location.href.split('#')[1];
        console.log('param', param);
        let currentKey, lastKey;
        let articles;
        fetch('./list.json')
            .then((response) => response.text())
            .then((text) => {
                articles = JSON.parse(text);
                let menu = document.createElement('div');
                $(menu).addClass('menu');
                for (const key in articles) {
                    console.log('key', key);
                    let menuItem = document.createElement('div');
                    menuItem.onclick = () => render(key);
                    menuItem.id = 'file-' + key;
                    menuItem.classList.add('item');
                    let menuTextItem = document.createElement('p');
                    menuTextItem.innerText = articles[key];
                    menuItem.appendChild(menuTextItem);
                    menu.appendChild(menuItem);
                    if (param === key) {
                        currentKey = key;
                    }
                }
                $('#list').append(menu);
                if (!currentKey) {
                    currentKey = Object.keys(articles)[0];
                }
                render(currentKey);
            });

        function render(key) {
            loading(true);
            if (lastKey === key) {
                loading(false);
                return;
            }
            window.location.href = '#' + key;
            $('#list .menu .item').removeClass('active');
            $('#file-' + key).addClass('active');
            document.title = 'Article > ' + articles[key];
            lastKey = key;
            fetch('./md/' + key + '.md')
                .then((response) => response.text())
                .then((text) => {
                    $('#marked').html(marked(text));
                    linkOpenInNewTab();
                    pangu.spacingElementById('marked-wrapper');
                    setTimeout(() => loading(false), 200);
                });
        }

        function loading(on) {
            $('#marked-wrapper').css('display', on ? 'none' : 'block');
            $('#loading').css('display', on ? 'block' : 'none');
        }

        function linkOpenInNewTab() {
            $('a').each((index, item) => {
                $(item).prop('target', '_blank');
            });
            hljs.highlightAll();
        }
    </script>
</html>
